---
title: 图数据库OLAP算法
tags: [图数据库, OLAP]
---

# 图数据库算法

## 1. PageRank

PageRank算法作为计算互联网网页重要度的算法被提出。

实现伪代码：(d为阻尼系数，一般为0.85)
![pagerank](/images/graphdb/pagerank.png)


TextRank算法是一种基于图的用于关键词抽取和文档摘要的排序算法，基于PageRank算法改进而来。

## 2. Modularity 社区发现算法

主要涉及到两个方面：一方面是网络的拆分partition，另一方面是衡量这组partition的quality。

我们用modularity of the partition来表示这组拆分的quality：

$$
Q = \frac{1}{2m}\sum_{i,j}[A_{ij} - \frac{k_ik_j}{2m}]\delta(c_i, c_j)
$$

其中$A_{ij}$代表节点i,j间连接的权重，$k_i=\sum_jA_{ij}$即与节点i相连的所有边的权重之和，$c_i, c_j$表示节点i, j的commnity index；接下来的函数$\delta(c_i,c_j)$表示节点i,j是否在同一个community中（相同时取1，否则取0），最后$m=\frac{1}{2}\sum_{ij}A_{ij}$表示整个网络的连接权重总和。

注意到，Q的取值范围是在[-1,1]之间的。当i,j没有边相连，我们便可以认为$A_{ij}=0$，然而其他项是可能大于0的；这个设定意味着，这样加入一个节点（但这个节点与该community中的某些点没有连接），会带来负的作用。

### 2.1. 算法实现方法

算法可分为两个阶段，并不断重复迭代。

第一阶段:

我们有N个节点的网络：

 1. 为每一个节点都分配一个community index，即此时网络有N个community。此为初始状态
 2. 对每个节点i，我们考虑它的邻接节点j；我们让i的community变成j的，看这个动作对modularity的值有怎样的作用。如果这个变动带来的[公式]是正的，那我们就接纳这个变动，否则就保持原来的分配方式
好，第一个phase就是这样。当整个过程做到无法再提升的时候便停止。这里需要再注意一点，就是...初始点要怎么选？文章提到，初始点的选择对整个结果不会有太大影响，然而对整个计算时间有很大影响。

下面这个式子给出了“将节点i加入community C带来的modularity的变动：

$$\Delta Q = [\frac{(\sum_{in}+k_{i,in}}{2m} - (\frac{\sum_{tot} + k_i}{2m})^2] - [\frac{\sum_{in}}{2m} - (\frac{\sum_{tot}}{2m})^2 - (\frac{k_i}{2m})^2]$$

其中$\sum_{in}$是该community内部的连接权重总和，$\sum_{tot}$是所有与该community相连的边之权重和。


第二阶段:

经过第一阶段，使用Modularity Optimization给出一个划分。随后将同一个community进行折叠，折叠后形成一个新的网络，其中
 - community间的连接权重为连接两个community的节点之权重和
 - community内部的连接形成一个自环，其权重为该community内部连接的和

![phase-2](/images/graphdb/modularity_2.jpeg)


这两个phase做完一轮后，称作pass；显然每次pass都会让community的数量变小。


## 3. Triangle Count

Triangle Count在社交网络分析中是非常有用的。这个三角形是一个三结点的小图，其中结点两两相连。假如，在Facebook上，你认识两个校友，而这两个校友彼此有相互认识，那么你们三个就组成了一个三角形。像这样的，社交网络拥有越多的三角形，其联系也就业紧密。
Triangle Count的算法思想如下：
 1. 计算每个结点的邻结点，
 2. 统计对每条边计算交集，并找出交集中id大于前两个结点id的结点，
 3. 对每个结点统计Triangle总数，注意只统计符合计算方向的Triangle Count。

注意：计算三角形时，要有计算方向（**起始结点id<中间结点id<目的结点id**）。

假设结点A和结点B是邻居。结点A的邻结点集合是{B，C，D，E}，结点B的邻结点集合是{A，C，E，F，G}，而它们的交集是{C，E}。交集中的结点是结点A和结点B的共同邻结点，所以有{A，B，C}和{A，B，E}两个三角形。

## LCC 局部聚集系数

对于无向图而言，聚集系数的公式为：

$$C(v_i) = \frac{2e_{jk}}{D(v_i)(D(v_i)-1)}$$

其中，$v_i$代表结点，$e_k$是计算该节点的Triangle Count值, $D(v_i)$为结点 $v_i$​的邻接点个数。